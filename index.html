<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Blessed MAX — Mini App</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    }
    body {
      margin: 0; padding: 16px;
      background: var(--tg-theme-secondary-bg-color, #111);
      color: var(--tg-theme-text-color, #fff);
    }
    .card {
      background: var(--tg-theme-bg-color, #1b1b1b);
      border: 1px solid rgba(255,255,255,.06);
      border-radius: 16px;
      padding: 16px;
      box-shadow: 0 6px 24px rgba(0,0,0,.25);
    }
    h1 { margin: 0 0 8px; font-size: 20px; }
    p { margin: 0 0 12px; opacity: .9; }
    input, textarea {
      width: 100%; box-sizing: border-box;
      background: var(--tg-theme-secondary-bg-color, #111);
      color: var(--tg-theme-text-color, #fff);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 12px;
      padding: 10px 12px;
      outline: none;
    }
    .row { display: grid; gap: 12px; margin: 12px 0; }
    button {
      width: 100%;
      padding: 12px 16px;
      font-weight: 600;
      border: 0; border-radius: 12px;
      cursor: pointer;
      background: var(--tg-theme-button-color, #2ea6ff);
      color: var(--tg-theme-button-text-color, #fff);
    }
    .hint { font-size: 12px; opacity: .7; margin-top: 8px; }
  </style>
</head>
<body>
  <div class="card">
    <h1>Blessed MAX</h1>
    <p id="hello">Загрузка…</p>

    <div class="row">
      <input id="title" placeholder="Заголовок" />
      <textarea id="note" rows="5" placeholder="Сообщение для бота"></textarea>
    </div>

    <button id="send">Отправить в бота</button>
    <div class="hint">Данные отправятся как <code>web_app_data</code> и бот ответит в чате.</div>
  </div>

  <script>
    const tg = window.Telegram?.WebApp;

    // Безопасно инициализируем
    tg?.ready();
    // Разворачиваем на максимум
    tg?.expand();

    // Применяем цвета темы Телеграма (автоматически, но можно дополнительно)
    if (tg?.themeParams) {
      document.body.style.background = tg.themeParams.secondary_bg_color || '';
      document.body.style.color = tg.themeParams.text_color || '';
    }

    // Поприветствуем пользователя
    const helloEl = document.getElementById('hello');
    const user = tg?.initDataUnsafe?.user;
    helloEl.textContent = user
      ? `Привет, ${user.first_name}${user.last_name ? ' ' + user.last_name : ''}!`
      : 'Привет!';

    // Кнопка отправки данных в бота
    document.getElementById('send').addEventListener('click', () => {
      const title = document.getElementById('title').value.trim();
      const note = document.getElementById('note').value.trim();

      const payload = {
        type: 'blessed_max_form',
        title: title || null,
        note: note || null,
        ts: Date.now()
      };

      try {
        tg.sendData(JSON.stringify(payload)); // улетит в update.message.web_app_data.data
        tg.close(); // по желанию — закрыть Mini App
      } catch (e) {
        alert('Не удалось отправить данные: ' + e.message);
      }
    });
  </script>
</body>
</html>
